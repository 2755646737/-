<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全联赛赛事查询系统（最终修复版）</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Microsoft YaHei', sans-serif; }
        body { padding: 20px; background-color: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: #2d3748; margin-bottom: 30px; font-size: 24px; }
        .form-group { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        label { font-weight: 600; color: #4a5568; min-width: 100px; }
        select, input { padding: 10px 15px; border: 1px solid #dee2e6; border-radius: 4px; flex: 1; min-width: 200px; font-size: 14px; }
        input[readonly] { background-color: #f8f9fa; cursor: not-allowed; }
        .btn-group { display: flex; gap: 15px; margin: 30px 0; }
        button { padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 600; }
        .btn-add { background-color: #4299e1; color: #fff; }
        .btn-add:hover { background-color: #3182ce; }
        .btn-delete { background-color: #e53e3e; color: #fff; }
        .btn-delete:hover { background-color: #c53030; }
        .btn-export { background-color: #48bb78; color: #fff; }
        .btn-export:hover { background-color: #38a169; }
        .btn-reset { background-color: #ed8936; color: #fff; }
        .btn-reset:hover { background-color: #dd6b20; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 15px; text-align: center; border: 1px solid #dee2e6; font-size: 14px; }
        th { background-color: #f8f9fa; font-weight: 600; color: #2d3748; position: sticky; top: 0; z-index: 10; }
        tr:nth-child(even) { background-color: #fafafa; }
        tr:hover { background-color: #f0f8fb; }
        .table-container { max-height: 500px; overflow-y: auto; margin-top: 10px; }
        .form-row { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 20px; }
        .form-col { flex: 1; min-width: 250px; }
        @media (max-width: 768px) {
            .form-row { flex-direction: column; gap: 10px; }
            .btn-group { flex-direction: column; }
            button { width: 100%; }
        }
    </style>
  <!-- 原有CSS样式不变，直接在后面加 -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192x192.png">
  <meta name="apple-mobile-web-app-status-bar-style" content="#4299e1">
  <meta name="apple-mobile-web-app-title" content="赛事查询">
</head>
<body>
    <div class="container">
        <h1>全联赛赛事查询系统（最终修复版）</h1>
        
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="league">联赛/赛事：</label>
                    <select id="league" onchange="handleLeagueChange()">
                        <!-- 国际赛事（无简称，保留全称） -->
                        <option value="world-cup">世界杯</option>
                        <option value="euro-cup">欧洲杯</option>
                        <option value="champions-league">欧冠联赛</option>
                        <option value="europa-league">欧联杯</option>
                        <option value="copa-america">美洲杯</option>
                        <option value="libertadores">南美解放者杯</option>
                        <option value="afc-champions">亚冠联赛</option>
                        <option value="club-world-cup">世俱杯</option>
                        <option value="euro-confederations">欧会杯</option>
                        <!-- 欧洲五大联赛（用简称） -->
                        <option value="england-1">英超</option>
                        <option value="england-2">英冠</option>
                        <option value="england-3">英甲</option>
                        <option value="spain-1">西甲</option>
                        <option value="spain-2">西乙</option>
                        <option value="spain-3">西丙</option>
                        <option value="italy-1">意甲</option>
                        <option value="italy-2">意乙</option>
                        <option value="italy-3">意丙</option>
                        <option value="germany-1">德甲</option>
                        <option value="germany-2">德乙</option>
                        <option value="germany-3">德丙</option>
                        <option value="france-1">法甲</option>
                        <option value="france-2">法乙</option>
                        <option value="france-3">法丙</option>
                        <!-- 其他欧洲联赛（用简称） -->
                        <option value="netherlands-1">荷甲</option>
                        <option value="netherlands-2">荷乙</option>
                        <option value="netherlands-3">荷丙</option>
                        <option value="portugal-1">葡超</option>
                        <option value="portugal-2">葡甲</option>
                        <option value="portugal-3">葡乙</option>
                        <option value="belgium-1">比甲</option>
                        <option value="belgium-2">比乙</option>
                        <option value="belgium-3">比丙</option>
                        <option value="turkey-1">土超</option>
                        <option value="turkey-2">土甲</option>
                        <option value="turkey-3">土乙</option>
                        <option value="russia-1">俄超</option>
                        <option value="russia-2">俄甲</option>
                        <option value="russia-3">俄乙</option>
                        <option value="scotland-1">苏超</option>
                        <option value="scotland-2">苏冠</option>
                        <option value="scotland-3">苏甲</option>
                        <option value="sweden-1">瑞超</option>
                        <option value="sweden-2">瑞甲</option>
                        <option value="sweden-3">瑞乙</option>
                        <option value="norway-1">挪超</option>
                        <option value="norway-2">挪甲</option>
                        <option value="norway-3">挪乙</option>
                        <option value="denmark-1">丹超</option>
                        <option value="denmark-2">丹甲</option>
                        <option value="denmark-3">丹乙</option>
                        <option value="finland-1">芬超</option>
                        <option value="finland-2">芬甲</option>
                        <option value="finland-3">芬乙</option>
                        <option value="switzerland-1">瑞士超</option>
                        <option value="switzerland-2">瑞士甲</option>
                        <option value="switzerland-3">瑞士乙</option>
                        <option value="austria-1">奥超</option>
                        <option value="austria-2">奥甲</option>
                        <option value="austria-3">奥乙</option>
                        <option value="czech-1">捷超</option>
                        <option value="czech-2">捷甲</option>
                        <option value="czech-3">捷乙</option>
                        <option value="poland-1">波超</option>
                        <option value="poland-2">波甲</option>
                        <option value="poland-3">波乙</option>
                        <option value="greece-1">希超</option>
                        <option value="greece-2">希甲</option>
                        <option value="greece-3">希乙</option>
                        <!-- 美洲联赛（用简称） -->
                        <option value="brazil-1">巴甲</option>
                        <option value="brazil-2">巴乙</option>
                        <option value="brazil-3">巴丙</option>
                        <option value="argentina-1">阿甲</option>
                        <option value="argentina-2">阿乙</option>
                        <option value="argentina-3">阿丙</option>
                        <option value="uruguay-1">乌甲</option>
                        <option value="uruguay-2">乌乙</option>
                        <option value="uruguay-3">乌丙</option>
                        <option value="mls-1">美职联</option>
                        <option value="mexico-1">墨超</option>
                        <option value="mexico-2">墨甲</option>
                        <option value="colombia-1">哥超</option>
                        <option value="colombia-2">哥甲</option>
                        <option value="peru-1">秘超</option>
                        <option value="peru-2">秘甲</option>
                        <option value="chile-1">智超</option>
                        <option value="chile-2">智甲</option>
                        <!-- 亚洲联赛（用简称） -->
                        <option value="china-1">中超</option>
                        <option value="china-2">中甲</option>
                        <option value="china-3">中乙</option>
                        <option value="japan-1">J1联赛</option>
                        <option value="japan-2">J2联赛</option>
                        <option value="japan-3">J3联赛</option>
                        <option value="south-korea-1">K1联赛</option>
                        <option value="south-korea-2">K2联赛</option>
                        <option value="south-korea-3">K3联赛</option>
                        <option value="australia-1">澳超</option>
                        <option value="australia-2">澳甲</option>
                        <option value="saudi-1">沙超</option>
                        <option value="saudi-2">沙甲</option>
                        <option value="saudi-3">沙乙</option>
                        <option value="qatar-1">卡超</option>
                        <option value="qatar-2">卡甲</option>
                        <option value="qatar-3">卡乙</option>
                        <option value="uae-1">阿超</option>
                        <option value="uae-2">阿甲</option>
                        <option value="thailand-1">泰超</option>
                        <option value="thailand-2">泰甲</option>
                        <option value="malaysia-1">马超</option>
                        <option value="malaysia-2">马甲</option>
                        <!-- 自定义选项 -->
                        <option value="custom">其他联赛（自定义球队）</option>
                    </select>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="home-team">主队：</label>
                    <select id="home-team" required>
                        <option value="">请选择联赛</option>
                    </select>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="away-team">客队：</label>
                    <select id="away-team" required>
                        <option value="">请选择联赛</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="score">预测比分：</label>
                    <select id="score" required>
                        <option value="">选择比分</option>
                        <option value="0-0">0-0</option><option value="1-0">1-0</option><option value="0-1">0-1</option><option value="1-1">1-1</option><option value="2-0">2-0</option>
                        <option value="0-2">0-2</option><option value="2-1">2-1</option><option value="1-2">1-2</option><option value="2-2">2-2</option><option value="3-0">3-0</option>
                        <option value="0-3">0-3</option><option value="3-1">3-1</option><option value="1-3">1-3</option><option value="3-2">3-2</option><option value="2-3">2-3</option>
                        <option value="3-3">3-3</option><option value="4-0">4-0</option><option value="0-4">0-4</option><option value="4-1">4-1</option><option value="1-4">1-4</option>
                        <option value="胜其他">胜其他</option>
                        <option value="平其他">平其他</option>
                        <option value="负其他">负其他</option>
                    </select>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="handicap">让球：</label>
                    <select id="handicap" required>
                        <option value="">选择让球</option>
                        <!-- 纯数字加减格式，覆盖所有竞彩常见盘口 -->
                        <option value="+1">+1</option>
                        <option value="-1">-1</option>
                        
                    </select>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="odds-change">赔率变化：</label>
                    <input type="text" id="odds-change" required placeholder="例如:降为1,升为2">
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn-add" onclick="addData()">添加数据</button>
            <button class="btn-delete" onclick="deleteSelectedData()">删除选中数据</button>
            <button class="btn-export" onclick="exportCSV()">导出CSV表格</button>
            <button class="btn-reset" onclick="resetAll()">重置所有数据</button>
        </div>

        <div class="table-container">
            <table id="data-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all" onclick="selectAll()"></th>
                        <th>日期</th>
                        <th>联赛/赛事</th>
                        <th>主队</th>
                        <th>客队</th>
                        <th>预测比分</th>
                        <th>让球</th>
                        <th>赔率变化</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- 数据将动态添加 -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 先引入本地存储工具，再加载原代码 -->
    <script src="idb.js"></script>

    <script>
        // 赛事-球队映射表（补全所有缺漏球队）
        const leagueTeams = {
            "world-cup": ["巴西", "阿根廷", "法国", "德国", "西班牙", "英格兰", "葡萄牙", "比利时", "荷兰", "克罗地亚", "乌拉圭", "瑞士", "美国", "墨西哥", "日本", "韩国", "沙特", "伊朗", "卡塔尔", "厄瓜多尔", "塞内加尔", "突尼斯", "摩洛哥", "波兰", "威尔士", "加拿大", "澳大利亚", "哥斯达黎加", "塞尔维亚", "加纳", "喀麦隆"],
            "euro-cup": ["法国", "德国", "西班牙", "英格兰", "意大利", "葡萄牙", "比利时", "荷兰", "克罗地亚", "瑞士", "丹麦", "奥地利", "波兰", "瑞典", "塞尔维亚", "乌克兰", "威尔士", "土耳其", "斯洛伐克", "斯洛文尼亚", "北马其顿", "匈牙利", "苏格兰", "罗马尼亚"],
            "champions-league": ["曼城", "皇马", "拜仁", "利物浦", "巴萨", "曼联", "AC米兰", "尤文图斯", "多特蒙德", "巴黎圣日耳曼", "阿贾克斯", "本菲卡", "波尔图", "莱比锡", "马德里竞技", "那不勒斯", "布鲁日", "凯尔特人", "RB萨尔茨堡", "顿涅茨克矿工", "国际米兰", "拉齐奥"],
            "europa-league": ["西汉姆联", "塞维利亚", "罗马", "曼联", "阿森纳", "尤文图斯", "多特蒙德", "阿贾克斯", "埃因霍温", "里斯本竞技", "勒沃库森", "亚特兰大", "巴塞尔", "费耶诺德", "皇家社会", "比利亚雷亚尔", "雷恩", "弗赖堡", "萨尔茨堡红牛", "中日德兰"],
            "copa-america": ["巴西", "阿根廷", "乌拉圭", "智利", "哥伦比亚", "秘鲁", "委内瑞拉", "厄瓜多尔", "玻利维亚", "巴拉圭", "墨西哥", "美国", "加拿大", "哥斯达黎加", "巴拿马", "牙买加"],
            "libertadores": ["弗拉门戈", "圣保罗", "博卡青年", "河床", "科林蒂安", "帕尔梅拉斯", "桑托斯", "格雷米奥", "拉普拉塔大学生", "独立队", "民族队", "佩纳罗尔", "米内罗竞技", "巴兰基亚青年", "麦德林国民", "利马联盟"],
            "afc-champions": ["利雅得胜利", "利雅得新月", "吉达联合", "阿尔希拉尔", "浦和红钻", "川崎前锋", "横滨水手", "鹿岛鹿角", "全北现代", "蔚山现代", "FC首尔", "山东泰山", "上海海港", "北京国安", "墨尔本胜利"],
            "club-world-cup": ["曼城", "弗拉门戈", "利雅得新月", "浦和红钻", "西雅图海湾人", "开罗国民", "奥克兰城"],
            "euro-confederations": ["西汉姆联", "佛罗伦萨", "勒沃库森", "布莱顿", "罗马", "阿贾克斯", "安德莱赫特", "巴塞尔", "布拉加", "费耶诺德"],
            "england-1": ["曼城", "利物浦", "阿森纳", "曼联", "切尔西", "托特纳姆", "阿斯顿维拉", "纽卡斯尔联", "布莱顿", "布伦特福德", "富勒姆", "水晶宫", "埃弗顿", "狼队", "莱斯特城", "利兹联", "南安普顿", "诺丁汉森林", "伯恩茅斯", "西汉姆联"],
            "england-2": ["伯恩利", "谢菲尔德联", "米德尔斯堡", "布莱克本", "桑德兰", "考文垂", "西布朗", "斯旺西", "沃特福德", "诺维奇", "雷丁", "卢顿", "赫尔城", "布里斯托尔城", "米尔沃尔", "普雷斯顿", "卡迪夫城", "斯托克城", "罗瑟汉姆", "维冈竞技"],
            "england-3": ["彼得堡联", "谢菲尔德星期三", "伊普斯维奇", "普利茅斯", "博尔顿", "阿克灵顿", "弗利特伍德", "莫克姆", "米尔顿凯恩斯", "查尔顿", "韦康比流浪者", "吉灵汉姆", "伯顿", "牛津联", "切尔滕汉姆", "朴茨茅斯", "埃克塞特城", "布里斯托尔流浪者", "维尔港", "莱顿东方"],
            "spain-1": ["巴塞罗那", "皇家马德里", "马德里竞技", "皇家社会", "贝蒂斯", "瓦伦西亚", "塞维利亚", "毕尔巴鄂竞技", "奥萨苏纳", "比利亚雷亚尔", "马洛卡", "赫塔菲", "塞尔塔", "莱万特", "阿拉维斯", "巴列卡诺", "格拉纳达", "加的斯", "埃尔切", "西班牙人"],
            "spain-2": ["拉斯帕尔马斯", "赫罗纳", "阿尔梅里亚", "巴拉多利德", "希洪竞技", "萨拉戈萨", "莱加内斯", "卡塔赫纳", "米兰德斯", "特内里费", "桑坦德竞技", "阿尔巴塞特", "富恩拉布雷达", "奥维耶多", "布尔戈斯", "马拉加", "伊维萨", "卢戈", "皇家奥维耶多", "梅利利亚"],
            "spain-3": ["巴塞罗那B队", "皇家马德里B队", "马德里竞技B队", "塞维利亚B队", "瓦伦西亚B队", "贝蒂斯B队", "毕尔巴鄂竞技B队", "萨拉戈萨B队", "赫塔菲B队", "塞尔塔B队", "马洛卡B队", "拉斯帕尔马斯B队", "阿尔梅里亚B队", "希洪竞技B队", "莱加内斯B队", "卡塔赫纳B队"],
            "italy-1": ["尤文图斯", "AC米兰", "国际米兰", "那不勒斯", "罗马", "拉齐奥", "亚特兰大", "佛罗伦萨", "博洛尼亚", "都灵", "萨索洛", "乌迪内斯", "恩波利", "斯佩齐亚", "莱切", "蒙扎", "维罗纳", "克雷莫纳", "桑普多利亚", "萨勒尼塔纳"],
            "italy-2": ["贝内文托", "莱切", "布雷西亚", "巴勒莫", "科森扎", "巴里", "希塔德拉", "弗洛西诺内", "帕尔马", "佩鲁贾", "雷吉纳", "斯帕尔", "特尔纳纳", "卡利亚里", "威尼斯", "比萨", "蒙扎", "阿斯科利", "亚历山德里亚", "克罗托内"],
            "italy-3": ["尤文图斯U23", "AC米兰U23", "国际米兰U23", "那不勒斯U23", "罗马U23", "拉齐奥U23", "亚特兰大U23", "佛罗伦萨U23", "博洛尼亚U23", "都灵U23", "萨索洛U23", "乌迪内斯U23", "恩波利U23", "斯佩齐亚U23", "莱切U23", "蒙扎U23"],
            "germany-1": ["拜仁慕尼黑", "多特蒙德", "莱比锡红牛", "勒沃库森", "沃尔夫斯堡", "法兰克福", "柏林联合", "门兴格拉德巴赫", "霍芬海姆", "弗赖堡", "美因茨", "奥格斯堡", "波鸿", "柏林赫塔", "科隆", "沙尔克04", "云达不莱梅", "斯图加特"],
            "germany-2": ["圣保利", "达姆施塔特", "海登海姆", "帕德博恩", "比勒菲尔德", "基尔高士丁", "汉诺威96", "卡尔斯鲁厄", "雷根斯堡", "布伦瑞克", "纽伦堡", "罗斯托克", "马格德堡", "桑德豪森", "菲尔特", "韦恩威斯巴登", "奥斯纳布吕克"],
            "germany-3": ["拜仁慕尼黑二队", "多特蒙德二队", "莱比锡红牛二队", "勒沃库森二队", "沃尔夫斯堡二队", "法兰克福二队", "柏林联合二队", "门兴格拉德巴赫二队", "霍芬海姆二队", "弗赖堡二队", "美因茨二队", "奥格斯堡二队", "波鸿二队", "柏林赫塔二队"],
            "france-1": ["巴黎圣日耳曼", "马赛", "里昂", "里尔", "摩纳哥", "雷恩", "尼斯", "朗斯", "斯特拉斯堡", "南特", "蒙彼利埃", "布雷斯特", "克莱蒙", "特鲁瓦", "昂热", "阿雅克肖", "图卢兹", "洛里昂", "兰斯", "欧塞尔"],
            "france-2": ["勒阿弗尔", "波尔多", "图卢兹", "南锡", "尼姆", "索肖", "瓦朗谢讷", "卡昂", "奎维利鲁昂", "巴黎FC", "奥尔良", "亚眠", "克维伊", "沙托鲁", "勒芒", "布尔格", "阿雅克肖GFCO", "罗德兹", "圣埃蒂安"],
            "france-3": ["巴黎圣日耳曼B队", "马赛B队", "里昂B队", "里尔B队", "摩纳哥B队", "雷恩B队", "尼斯B队", "朗斯B队", "斯特拉斯堡B队", "南特B队", "蒙彼利埃B队", "布雷斯特B队", "克莱蒙B队", "特鲁瓦B队", "昂热B队"],
            "netherlands-1": ["阿贾克斯", "埃因霍温", "费耶诺德", "阿尔克马尔", "乌德勒支", "特温特", "格罗宁根", "海伦芬", "维特斯", "鹿特丹斯巴达", "坎布尔", "福图纳锡塔德", "前进之鹰", "瓦尔韦克", "奈梅亨", "兹沃勒"],
            "netherlands-2": ["威廉二世", "罗达JC", "布雷达", "埃门", "多德雷赫特", "海尔蒙德体育", "芬洛", "马斯特里赫特", "奥斯", "阿尔梅勒城", "登博思", "FC埃因霍温", "特尔斯达", "坎布尔二队"],
            "netherlands-3": ["阿贾克斯二队", "埃因霍温二队", "费耶诺德二队", "阿尔克马尔二队", "乌德勒支二队", "特温特二队", "格罗宁根二队", "海伦芬二队", "维特斯二队", "鹿特丹斯巴达二队"],
            "portugal-1": ["本菲卡", "波尔图", "里斯本竞技", "布拉加", "吉马良斯", "阿维河", "博阿维斯塔", "马里迪莫", "帕索斯费雷拉", "里奥阿维", "塞图巴尔", "埃斯托里尔", "法马利康", "贝伦人", "通德拉", "吉维森特"],
            "portugal-2": ["波尔蒂芒人", "查维斯", "费雷拉", "科瓦彼达迪", "圣克拉拉", "莫雷伦斯", "佩纳菲耶尔", "维塞乌", "奥利维伦斯", "萨古伊罗斯"],
            "portugal-3": ["本菲卡二队", "波尔图二队", "里斯本竞技二队", "布拉加二队", "吉马良斯二队", "阿维河二队", "博阿维斯塔二队", "马里迪莫二队"],
            "belgium-1": ["布鲁日", "亨克", "根特", "安德莱赫特", "标准列日", "梅赫伦", "塞尔克", "科特赖克", "奥斯坦德", "沙勒罗瓦", "威尔郡", "圣图尔登", "色格拉布鲁日", "莫伦贝克"],
            "belgium-2": ["安特卫普", "洛克伦", "华斯兰德贝弗伦", "洛默尔", "蒂比兹", "登德尔莱乌", "维尔赖克", "科特赖克二队", "奥斯坦德二队"],
            "belgium-3": ["布鲁日二队", "亨克U23", "根特U23", "安德莱赫特U23", "标准列日U23", "梅赫伦U23", "塞尔克U23"],
            "turkey-1": ["加拉塔萨雷", "费内巴切", "贝西克塔斯", "特拉布宗体育", "伊斯坦布尔", "安塔利亚体育", "布尔萨体育", "开塞利体育", "锡瓦斯体育", "阿达纳体育", "科尼亚体育", "代米尔体育"],
            "turkey-2": ["加拉塔萨雷二队", "费内巴切二队", "贝西克塔斯二队", "特拉布宗体育二队", "伊斯坦布尔二队", "安塔利亚体育二队", "布尔萨体育二队"],
            "turkey-3": ["加拉塔萨雷U21", "费内巴切U21", "贝西克塔斯U21", "特拉布宗体育U21", "伊斯坦布尔U21", "安塔利亚体育U21"],
            "russia-1": ["莫斯科中央陆军", "圣彼得堡泽尼特", "莫斯科斯巴达", "喀山红宝石", "莫斯科迪纳摩", "克拉斯诺达尔", "罗斯托夫", "图拉兵工厂", "乌法", "索契"],
            "russia-2": ["莫斯科中央陆军二队", "圣彼得堡泽尼特二队", "莫斯科斯巴达二队", "喀山红宝石二队", "莫斯科迪纳摩二队", "克拉斯诺达尔二队"],
            "russia-3": ["莫斯科中央陆军U21", "圣彼得堡泽尼特U21", "莫斯科斯巴达U21", "喀山红宝石U21", "莫斯科迪纳摩U21"],
            "scotland-1": ["凯尔特人", "流浪者", "阿伯丁", "希伯尼安", "哈茨", "圣约翰斯顿", "马瑟韦尔", "邓迪联", "圣米伦", "罗斯郡"],
            "scotland-2": ["邓迪", "帕尔蒂克", "格林诺克 Morton", "汉密尔顿", "南部女王", "利文斯顿", "考登比斯"],
            "scotland-3": ["凯尔特人B队", "流浪者B队", "阿伯丁B队", "希伯尼安B队", "哈茨B队"],
            "sweden-1": ["马尔默", "AIK索尔纳", "哈马比", "佐加顿斯", "厄勒布鲁", "卡尔马", "埃尔夫斯堡", "哥德堡", "北雪平", "赫尔辛堡"],
            "sweden-2": ["马尔默二队", "AIK索尔纳二队", "哈马比二队", "佐加顿斯二队", "厄勒布鲁二队", "卡尔马二队"],
            "sweden-3": ["马尔默U21", "AIK索尔纳U21", "哈马比U21", "佐加顿斯U21", "厄勒布鲁U21"],
            "norway-1": ["罗森博格", "莫尔德", "博德闪耀", "瓦勒伦加", "维京", "海于格松", "布兰", "斯塔贝克", "利勒斯特伦", "桑德菲杰"],
            "norway-2": ["罗森博格二队", "莫尔德二队", "博德闪耀二队", "瓦勒伦加二队", "维京二队", "海于格松二队"],
            "norway-3": ["罗森博格U21", "莫尔德U21", "博德闪耀U21", "瓦勒伦加U21", "维京U21"],
            "denmark-1": ["哥本哈根", "布隆德比", "中日德兰", "奥尔堡", "奥胡斯", "灵比", "锡尔克堡", "兰德斯", "霍森斯", "维堡"],
            "denmark-2": ["哥本哈根二队", "布隆德比二队", "中日德兰二队", "奥尔堡二队", "奥胡斯二队", "灵比二队"],
            "denmark-3": ["哥本哈根U21", "布隆德比U21", "中日德兰U21", "奥尔堡U21", "奥胡斯U21"],
            "finland-1": ["赫尔辛基", "HJK赫尔辛基", "罗瓦涅米", "拉赫蒂", "坦佩雷联", "玛丽港", "科特卡", "塞伊奈约基", "瓦萨", "奥卢"],
            "finland-2": ["赫尔辛基二队", "HJK赫尔辛基二队", "罗瓦涅米二队", "拉赫蒂二队", "坦佩雷联二队"],
            "finland-3": ["赫尔辛基U21", "HJK赫尔辛基U21", "罗瓦涅米U21", "拉赫蒂U21"],
            "switzerland-1": ["巴塞尔", "苏黎世", "伯尔尼年轻人", "圣加仑", "卢塞恩", "锡永", "草蜢", "洛桑体育", "温特图尔", "塞尔维特"],
            "switzerland-2": ["巴塞尔二队", "苏黎世二队", "伯尔尼年轻人二队", "圣加仑二队", "卢塞恩二队"],
            "switzerland-3": ["巴塞尔U21", "苏黎世U21", "伯尔尼年轻人U21", "圣加仑U21"],
            "austria-1": ["萨尔茨堡红牛", "维也纳快速", "奥地利维也纳", "格拉茨风暴", "林茨", "沃尔夫斯贝格", "马特斯堡", "里德", "圣珀尔滕", "阿德米拉"],
            "austria-2": ["萨尔茨堡红牛二队", "维也纳快速二队", "奥地利维也纳二队", "格拉茨风暴二队", "林茨二队"],
            "austria-3": ["萨尔茨堡红牛U21", "维也纳快速U21", "奥地利维也纳U21", "格拉茨风暴U21"],
            "czech-1": ["布拉格斯拉维亚", "布拉格杜克", "比尔森胜利", "斯洛伐克人", "奥洛穆茨", "布尔诺", "利贝雷茨", "卡尔维纳", "姆拉达博莱斯拉夫"],
            "czech-2": ["布拉格斯拉维亚二队", "布拉格杜克二队", "比尔森胜利二队", "斯洛伐克人二队", "奥洛穆茨二队"],
            "czech-3": ["布拉格斯拉维亚U21", "布拉格杜克U21", "比尔森胜利U21", "斯洛伐克人U21"],
            "poland-1": ["华沙莱吉亚", "克拉科夫维斯瓦", "波兹南莱赫", "格但斯克列治亚", "弗罗茨瓦夫", "西里西亚", "卢布林", "什切青波贡"],
            "poland-2": ["华沙莱吉亚二队", "克拉科夫维斯瓦二队", "波兹南莱赫二队", "格但斯克列治亚二队", "弗罗茨瓦夫二队"],
            "poland-3": ["华沙莱吉亚U21", "克拉科夫维斯瓦U21", "波兹南莱赫U21", "格但斯克列治亚U21"],
            "greece-1": ["奥林匹亚科斯", "帕纳辛奈科斯", "雅典AEK", "塞萨洛尼基", "阿里斯", "拉米亚", "维洛斯NFC", "特里波利斯", "莱瓦贾科斯"],
            "greece-2": ["奥林匹亚科斯二队", "帕纳辛奈科斯二队", "雅典AEK二队", "塞萨洛尼基二队", "阿里斯二队"],
            "greece-3": ["奥林匹亚科斯U21", "帕纳辛奈科斯U21", "雅典AEKU21", "塞萨洛尼基U21"],
            "brazil-1": ["弗拉门戈", "圣保罗", "科林蒂安", "帕尔梅拉斯", "桑托斯", "格雷米奥", "米内罗竞技", "瓦斯科达伽马", "弗鲁米嫩塞", "博塔弗戈", "巴西国际", "阿瓦伊", "塞阿拉", "福塔莱萨", "库亚巴", "布拉甘蒂诺", "巴伊亚", "累西腓体育", "戈亚斯", "米内罗美洲"],
            "brazil-2": ["巴伊亚", "累西腓体育", "戈亚斯", "维多利亚", "米内罗美洲", "克里西乌马", "庞特普雷塔", "伊图阿诺"],
            "brazil-3": ["弗拉门戈二队", "圣保罗二队", "科林蒂安二队", "帕尔梅拉斯二队", "桑托斯二队", "格雷米奥二队"],
            "argentina-1": ["博卡青年", "河床", "独立队", "拉普拉塔大学生", "圣洛伦索", "萨斯菲尔德", "飓风队", "纽维尔老男孩"],
            "argentina-2": ["阿韦亚内达竞技", "拉努斯", "奥林匹奥", "查卡里塔青年", "阿尔多西维", "布朗竞技"],
            "argentina-3": ["博卡青年二队", "河床二队", "独立队二队", "拉普拉塔大学生二队", "圣洛伦索二队"],
            "uruguay-1": ["佩纳罗尔", "民族队", "蒙得维的亚利物浦", "防卫者体育", "乌拉圭民族", "波士顿河"],
            "uruguay-2": ["佩纳罗尔二队", "民族队二队", "蒙得维的亚利物浦二队", "防卫者体育二队"],
            "uruguay-3": ["佩纳罗尔U20", "民族队U20", "蒙得维的亚利物浦U20", "防卫者体育U20"],
            "mls-1": ["洛杉矶银河", "洛杉矶FC", "纽约红牛", "纽约城", "西雅图海湾人", "波特兰伐木工", "亚特兰大联", "多伦多FC", "迈阿密国际", "纳什维尔SC", "奥斯汀FC", "夏洛特FC", "辛辛那提FC", "科罗拉多急流", "哥伦布机员", "达拉斯FC", "华盛顿联", "休斯顿迪纳摩", "堪萨斯城竞技", "明尼苏达联", "新英格兰革命", "奥兰多城", "费城联合", "皇家盐湖城", "圣何塞地震"],
            "mexico-1": ["美洲", "瓜达拉哈拉", "蒙特雷", "老虎大学", "帕丘卡", "莱昂", "墨西哥美洲", "蓝十字"],
            "mexico-2": ["美洲二队", "瓜达拉哈拉二队", "蒙特雷二队", "老虎大学二队", "帕丘卡二队"],
            "colombia-1": ["麦德林国民", "巴兰基亚青年", "卡利体育", "国民竞技", "托利马体育", "麦德林独立"],
            "colombia-2": ["麦德林国民二队", "巴兰基亚青年二队", "卡利体育二队", "国民竞技二队"],
            "peru-1": ["利马联盟", "水晶体育", "胡安奥里奇", "梅尔加", "库斯科", "万卡约"],
            "peru-2": ["利马联盟二队", "水晶体育二队", "胡安奥里奇二队", "梅尔加二队"],
            "chile-1": ["科洛科洛", "天主教大学", "智利大学", "瓦奇巴托", "奥希金斯", "科布雷萨尔"],
            "chile-2": ["科洛科洛二队", "天主教大学二队", "智利大学二队", "瓦奇巴托二队"],
            "china-1": ["山东泰山", "上海海港", "武汉三镇", "北京国安", "长春亚泰", "河南嵩山龙门", "天津津门虎", "梅州客家", "浙江队", "成都蓉城", "深圳队", "大连人", "沧州雄狮", "青岛海牛", "南通支云", "上海申花"],
            "china-2": ["青岛西海岸", "济南兴洲", "四川九牛", "延边龙鼎", "黑龙江冰城", "辽宁沈阳城市", "苏州东吴", "广西平果哈嘹"],
            "china-3": ["泰安天贶", "济南融易", "淄博齐盛", "青岛红狮", "云南玉昆", "重庆铜梁龙"],
            "japan-1": ["浦和红钻", "川崎前锋", "横滨水手", "鹿岛鹿角", "大阪钢巴", "名古屋鲸八", "广岛三箭", "神户胜利船", "东京FC", "大阪樱花", "柏太阳神", "横滨FC", "町田泽维亚", "札幌冈萨多", "京都不死鸟", "新潟天鹅", "湘南海洋", "福冈黄蜂"],
            "japan-2": ["京都不死鸟", "大分三神", "长崎成功丸", "新潟天鹅", "山形山神", "群马草津温泉", "秋田蓝色闪电", "爱媛FC", "藤枝MYFC", "今治FC", "岩城FC", "千叶市原", "磐田喜悦", "富山胜利", "水户蜀葵", "大宫松鼠", "山口雷诺法", "熊本深红", "鸟栖砂岩", "德岛漩涡"],
            "japan-3": ["浦和红钻U23", "川崎前锋U23", "横滨水手U23", "鹿岛鹿角U23", "大阪钢巴U23", "鹿儿岛联", "高知联合", "鸟取飞翔", "福岛联", "沼津青蓝", "奈良俱乐部", "大阪FC", "冲绳FC", "宫崎特格瓦贾罗", "北九州向日葵", "枥木SC", "盛冈仙鹤", "金泽萨维根", "长野帕塞罗", "FC岐阜"],
            "south-korea-1": ["全北现代", "蔚山现代", "FC首尔", "仁川联合", "水原三星", "大邱FC", "浦项制铁", "光州FC", "济州联", "江原FC", "首尔衣恋", "大田韩亚市民", "金泉尚武", "釜山IPark"],
            "south-korea-2": ["全北现代二队", "蔚山现代二队", "FC首尔二队", "仁川联合二队", "水原三星二队", "大邱FC二队", "浦项制铁二队", "光州FC二队"],
            "south-korea-3": ["全北现代U22", "蔚山现代U22", "FC首尔U22", "仁川联合U22", "水原三星U22"],
            "australia-1": ["悉尼FC", "墨尔本胜利", "布里斯班狮吼", "阿德莱德联", "珀斯光荣", "纽卡斯尔喷气机", "中央海岸水手", "西部联", "麦克阿瑟FC", "墨尔本城", "西部悉尼流浪者", "惠灵顿凤凰"],
            "australia-2": ["悉尼FC二队", "墨尔本胜利二队", "布里斯班狮吼二队", "阿德莱德联二队", "珀斯光荣二队"],
            "saudi-1": ["利雅得胜利", "利雅得新月", "吉达联合", "阿尔希拉尔", "阿尔纳斯尔", "吉达国民", "利雅得青年", "达马克", "艾卜哈", "费哈", "布赖代合作", "布赖代先锋", "哈萨征服", "塔伊", "利雅得新月二队", "麦地那新月"],
            "saudi-2": ["利雅得胜利二队", "利雅得新月二队", "吉达联合二队", "阿尔希拉尔二队", "阿尔纳斯尔二队"],
            "saudi-3": ["利雅得胜利U23", "利雅得新月U23", "吉达联合U23", "阿尔希拉尔U23"],
            "qatar-1": ["阿尔萨德", "阿尔杜海尔", "阿尔贾什", "阿尔瓦克拉", "阿尔赖扬", "阿尔加拉法", "乌姆沙拉尔", "卡塔尔SC"],
            "qatar-2": ["阿尔萨德二队", "阿尔杜海尔二队", "阿尔贾什二队", "阿尔瓦克拉二队", "阿尔赖扬二队"],
            "qatar-3": ["阿尔萨德U23", "阿尔杜海尔U23", "阿尔贾什U23", "阿尔瓦克拉U23"],
            "uae-1": ["阿尔艾因", "阿尔阿赫利", "阿尔贾兹拉", "阿尔瓦赫达", "沙迦", "迪拜胜利"],
            "uae-2": ["阿尔艾因二队", "阿尔阿赫利二队", "阿尔贾兹拉二队", "阿尔瓦赫达二队"],
            "thailand-1": ["武里南联", "曼谷联", "春武里", "清莱联", "狮子港", "巴蜀基利", "曼谷玻璃", "北榄城", "清迈联", "素可泰"],
            "thailand-2": ["武里南联二队", "曼谷联二队", "春武里二队", "清莱联二队"],
            "malaysia-1": ["柔佛新山", "雪兰莪", "吉隆坡城", "槟城", "森美兰", "马六甲联", "吉打", "霹雳", "彭亨", "柔佛新山二队"],
            "malaysia-2": ["柔佛新山二队", "雪兰莪二队", "吉隆坡城二队", "槟城二队"],
            "custom": []
        };

        // 核心修复：选择联赛后立即加载球队（无延迟）
        function handleLeagueChange() {
            const league = document.getElementById('league').value;
            const homeTeamEl = document.getElementById('home-team');
            const awayTeamEl = document.getElementById('away-team');
            
            // 清空选项（直接重置，避免残留）
            homeTeamEl.innerHTML = '';
            awayTeamEl.innerHTML = '';
            
            // 自定义联赛：显示输入框
            if (league === 'custom') {
                homeTeamEl.outerHTML = '<input type="text" id="home-team" required placeholder="输入主队名称">';
                awayTeamEl.outerHTML = '<input type="text" id="away-team" required placeholder="输入客队名称">';
                // 重新获取元素引用
                homeTeamEl = document.getElementById('home-team');
                awayTeamEl = document.getElementById('away-team');
            } else {
                // 普通联赛：添加默认选项
                const defaultOpt = document.createElement('option');
                defaultOpt.value = '';
                defaultOpt.textContent = '选择球队';
                homeTeamEl.appendChild(defaultOpt.cloneNode(true));
                awayTeamEl.appendChild(defaultOpt);
                
                // 加载对应球队（确保映射表匹配）
                if (leagueTeams[league] && leagueTeams[league].length > 0) {
                    leagueTeams[league].forEach(team => {
                        const opt = document.createElement('option');
                        opt.value = team;
                        opt.textContent = team;
                        homeTeamEl.appendChild(opt.cloneNode(true));
                        awayTeamEl.appendChild(opt);
                    });
                } else {
                    const emptyOpt = document.createElement('option');
                    emptyOpt.value = '';
                    emptyOpt.textContent = '暂无球队数据';
                    homeTeamEl.appendChild(emptyOpt.cloneNode(true));
                    awayTeamEl.appendChild(emptyOpt);
                }
            }
        }

       
            // 1. 页面加载时，自动读取本地数据并显示
window.onload = function() {
  handleLeagueChange();
  loadDataFromDB(); // 加载保存过的数据
};

   //2. 读取本地数据并渲染表格
function loadDataFromDB() {
  IDB.getAllData().then(matches => {
    const tableBody = document.getElementById('table-body');
    tableBody.innerHTML = ''; // 清空表格
    matches.forEach(match => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="checkbox" class="select-row" data-id="${match.id}"></td>
        <td>${match.date}</td>
        <td>${match.leagueName}</td>
        <td>${match.homeTeam}</td>
        <td>${match.awayTeam}</td>
        <td>${match.score}</td>
        <td>${match.handicap}</td>
        <td>${match.oddsChange}</td>
      `;
      tableBody.appendChild(row);
    });
  });
}

// 3. 新增数据（保存到本地，刷新不丢失）
function addData() {
  const league = document.getElementById('league').value;
  const homeTeam = document.getElementById('home-team').value;
  const awayTeam = document.getElementById('away-team').value;
  const score = document.getElementById('score').value;
  const handicap = document.getElementById('handicap').value;
  const oddsChange = document.getElementById('odds-change').value;
  
  if (!league || !homeTeam || !awayTeam || !score || !handicap || !oddsChange) {
    alert('请填写所有必填项！');
    return;
  }

  const leagueSelect = document.getElementById('league');
  const leagueName = leagueSelect.options[leagueSelect.selectedIndex].text;
  const currentDate = new Date().toISOString().split('T')[0];

  // 保存到本地数据库
  IDB.addData({
    date: currentDate,
    leagueName: leagueName,
    homeTeam: homeTeam,
    awayTeam: awayTeam,
    score: score,
    handicap: handicap,
    oddsChange: oddsChange
  }).then(() => {
    loadDataFromDB(); // 刷新表格
    // 清空输入框
    document.getElementById('score').value = '';
    document.getElementById('handicap').value = '';
    document.getElementById('odds-change').value = '';
  });
}

        // 全选/取消全选
        function selectAll() {
            const checkAll = document.getElementById('select-all');
            const checks = document.querySelectorAll('.select-row');
            checks.forEach(check => check.checked = checkAll.checked);
        }

        // 4. 删除选中数据（从本地数据库删除）
function deleteSelectedData() {
  const checkboxes = document.querySelectorAll('.select-row:checked');
  if (checkboxes.length === 0) {
    alert('请选择要删除的数据！');
    return;
  }
  const ids = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
  IDB.deleteData(ids).then(() => loadDataFromDB());
}

        // 导出CSV函数（完整定义，解决exportCSV未定义）
function exportCSV() {
  const table = document.getElementById('data-table');
  if (!table) {
    alert('暂无数据可导出！');
    return;
  }
  let csv = '';
  const dateColumnHead = '日期'; // 你的日期列表头文字

  // 处理表头：过滤选中框列，调整日期列为第一列
  const headers = Array.from(table.querySelectorAll('th')).map(h => h.textContent.trim());
  const filteredHeaders = headers.filter(head => head !== '' && !head.includes('选择'));
  const dateIndex = filteredHeaders.findIndex(head => head === dateColumnHead);
  if (dateIndex > 0) {
    const dateHead = filteredHeaders.splice(dateIndex, 1)[0];
    filteredHeaders.unshift(dateHead);
  }
  csv += filteredHeaders.map(h => `"${h.replace(/"/g, '""')}"`).join(',') + '\r\n';

  // 处理数据行
  const rows = table.querySelectorAll('tbody tr');
  rows.forEach(row => {
    const cells = Array.from(row.querySelectorAll('td'));
    const filteredCells = cells.filter(cell => !cell.querySelector('input[type="checkbox"]'));
    let rowData = filteredCells.map(cell => {
      let cellText = cell.textContent.trim();
      if (cell.previousElementSibling?.textContent.trim() === dateColumnHead) {
        try {
          const date = new Date(cellText);
          if (!isNaN(date.getTime())) cellText = date.toISOString().slice(0, 10);
        } catch (err) {}
      }
      return `"${cellText.replace(/"/g, '""')}"`;
    });
    const dateDataIndex = rowData.findIndex((_, index) => index === dateIndex);
    if (dateDataIndex > 0) {
      const dateData = rowData.splice(dateDataIndex, 1)[0];
      rowData.unshift(dateData);
    }
    csv += rowData.join(',') + '\r\n';
  });

  // 下载文件
  const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.download = `赛事数据_${new Date().toISOString().slice(0, 10)}.csv`;
  a.href = url;
  a.click();
  URL.revokeObjectURL(url);
}

        // 5. 重置所有数据（清空本地数据库）
   /*function resetAll() {
  if (confirm('确定要清空所有数据吗？')) {
    IDB.clearData().then(() => {
      loadDataFromDB();
      document.getElementById('league').selectedIndex = 0;
      document.getElementById('score').value = '';
      document.getElementById('odds-change').value = '';
      handleLeagueChange();
    });
  }
}

        // 页面加载时初始化
        window.onload = function() {
            handleLeagueChange();
        };*/

        // 6. 注册离线缓存功能（放在<script>标签末尾）
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(registration => console.log('PWA注册成功'))
      .catch(error => console.log('PWA注册失败:', error));
  });
}
// 监听Service Worker的消息
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.addEventListener('message', (e) => {
    if (e.data.type === 'OFFLINE') {
      alert(e.data.msg); // 或在页面显示提示框
    } else if (e.data.type === 'ONLINE') {
      alert(e.data.msg);
      // 在线后重新请求数据
      fetchSubdiskData();
    }
  });
}
    </script>
</body>
</html>
