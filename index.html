<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>竞彩赛事数据管理系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft Yahei', sans-serif;
        }
        body {
            background-color: #f5f7fa;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
        }
        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .form-col {
            flex: 1;
            min-width: 250px;
        }
        .form-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        label {
            font-weight: 600;
            color: #4a5568;
            min-width: 100px;
        }
        select, input {
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            flex: 1;
            min-width: 200px;
            font-size: 14px;
        }
        .btn-group {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        .btn-add { background-color: #4299e1; color: #fff; }
        .btn-clear { background-color: #ed8936; color: #fff; }
        .btn-export { background-color: #319795; color: #fff; }
        .btn-upload { background-color: #9f7aea; color: #fff; }
        .btn-download { background-color: #48bb78; color: #fff; }
        .btn-single-delete { background-color: #e53e3e; color: #fff; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; }
        .table-container {
            width: 100%;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        th, td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
            word-wrap: break-word;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:nth-child(even) { background-color: #fafafa; }
        tr:hover { background-color: #f0f8ff; }
        .league-search-container {
            display: flex;
            gap: 10px;
            width: 100%;
        }
        .hidden { display: none !important; }
    </style>
</head>

<link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192x192.png">
  <meta name="apple-mobile-web-app-status-bar-style" content="#4299e1">
  <meta name="apple-mobile-web-app-title" content="赛事查询">

<body>
    <div class="container">
        <h1>竞彩赛事数据管理系统</h1>

        <!-- 表单区域 -->
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label>联赛：</label>
                    <div class="league-search-container">
                        <select id="leagueSelect" required>
                            <option value="">请选择联赛</option>
                        </select>
                        <input type="text" id="leagueSearchInput" placeholder="搜索联赛" oninput="searchLeagues()">
                    </div>
                </div>
                <div class="form-group">
                    <label>主队：</label>
                    <select id="homeTeamSelect" required>
                        <option value="">请先选择联赛</option>
                    </select>
                    <input type="text" id="homeTeamInput" class="hidden" placeholder="手动输入主队">
                </div>
                <div class="form-group">
                    <label>客队：</label>
                    <select id="awayTeamSelect" required>
                        <option value="">请先选择联赛</option>
                    </select>
                    <input type="text" id="awayTeamInput" class="hidden" placeholder="手动输入客队">
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label>让球：</label>
                    <select id="handicapSelect" required>
                        <option value="">请选择让球</option>
                        <option value="+1">+1</option>
                        <option value="-1">-1</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>比分：</label>
                    <select id="scoreSelect" required>
                        <option value="">请选择比分</option>
                        <option value="0-0">0-0</option>
                        <option value="1-0">1-0</option>
                        <option value="0-1">0-1</option>
                        <option value="1-1">1-1</option>
                        <option value="2-0">2-0</option>
                        <option value="0-2">0-2</option>
                        <option value="2-1">2-1</option>
                        <option value="1-2">1-2</option>
                        <option value="胜其他">胜其他</option>
                        <option value="平其他">平其他</option>
                        <option value="负其他">负其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>赔率变化：</label>
                    <input type="text" id="oddsChangeInput" placeholder="请输入赔率变化" required>
                </div>
            </div>
        </div>

        <!-- 核心五按钮组 -->
        <div class="btn-group">
            <button class="btn-add" onclick="addData()">添加数据</button>
            <button class="btn-clear" onclick="clearAllData()">清空本地数据</button>
            <button class="btn-export" onclick="exportLocalData()">导出本地</button>
            <button class="btn-upload" onclick="uploadToCloud()">上传云端</button>
            <button class="btn-download" onclick="downloadFromCloud()">下载云端</button>
        </div>

        <!-- 数据表格区域 -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>日期</th>
                        <th>联赛</th>
                        <th>主队</th>
                        <th>客队</th>
                        <th>让球</th>
                        <th>比分</th>
                        <th>赔率变化</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="8" align="center">暂无赛事数据</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="idb.js"></script>

    <script>
        // ========== 3. 全球联赛-球队映射表（完善版） ==========
        // 规则：联赛/球队有简称用简称，无简称用全称，无括号信息，含其他联赛
        const leagueTeamsMap = {
            // 欧洲
            "英超": ["曼联", "曼城", "利物浦", "阿森纳", "切尔西", "热刺", "纽卡", "维拉", "布莱顿", "富勒姆", "埃弗顿", "莱斯特", "狼队", "水晶宫", "诺丁汉", "伯恩茅斯", "布伦特福德", "西汉姆", "卢顿", "谢菲联"],
            "英冠": ["利兹联", "南安普顿", "莱斯特", "伊普斯维奇", "谢周三", "考文垂", "西布朗", "赫尔城", "米德尔斯堡", "桑德兰", "斯托克城", "布莱克本", "布里斯托尔", "普雷斯顿", "伯明翰", "卡迪夫", "QPR", "罗瑟汉姆", "哈德斯菲尔德", "雷丁", "沃特福德", "斯旺西"],
            "英甲": ["朴茨茅斯", "谢菲联U23", "伊普斯维奇U23", "米尔顿凯恩斯", "维冈", "查尔顿", "博尔顿", "牛津联", "弗利特伍德", "伯顿", "阿克灵顿", "剑桥联", "埃克塞特", "林肯城", "彼得堡联", "什鲁斯伯里", "沃尔索尔", "唐卡斯特", "莫克姆", "切尔滕汉姆", "莱顿东方", "北安普顿"],
            "西甲": ["皇马", "巴萨", "马竞", "毕尔巴鄂", "塞维利亚", "贝蒂斯", "瓦伦西亚", "比利亚雷亚尔", "奥萨苏纳", "赫塔菲", "塞尔塔", "西班牙人", "巴列卡诺", "马洛卡", "阿尔梅里亚", "皇家社会", "加的斯", "格拉纳达", "巴拉多利德", "拉斯帕尔马斯"],
            "西乙": ["西班牙人B队", "马洛卡B队", "阿尔梅里亚B队", "格拉纳达B队", "巴拉多利德B队", "拉斯帕尔马斯B队", "萨拉戈萨", "希洪竞技", "莱万特", "韦斯卡", "布尔戈斯", "米兰德斯", "卡塔赫纳", "阿尔巴塞特", "赫罗纳", "奥维耶多", "桑坦德", "卢戈", "费罗尔", "安道尔FC", "埃瓦尔", "阿莫雷别塔"],
            "西乙B": ["皇马B队", "巴萨B队", "马竞B队", "塞维利亚B队", "贝蒂斯B队", "瓦伦西亚B队", "比利亚雷亚尔B队", "奥萨苏纳B队", "赫塔菲B队", "塞尔塔B队", "西班牙人C队", "巴列卡诺B队", "马洛卡C队", "阿尔梅里亚C队", "皇家社会B队"],
            "德甲": ["拜仁", "多特", "勒沃库森", "莱比锡", "法兰克福", "沃尔夫斯堡", "弗赖堡", "美因茨", "门兴", "柏林联", "霍芬海姆", "科隆", "奥格斯堡", "波鸿", "沙尔克04", "斯图加特", "不莱梅", "海登海姆"],
            "德乙": ["圣保利", "达姆施塔特", "汉堡", "纽伦堡", "基尔高士丁", "汉诺威96", "卡尔斯鲁厄", "雷根斯堡", "菲尔特", "马格德堡", "布伦瑞克", "荷尔斯泰因基尔", "罗斯托克", "帕德博恩", "桑德豪森", "韦恩威斯巴登", "海登海姆二队"],
            "德丙": ["奥斯纳布吕克", "比勒菲尔德", "凯泽斯劳滕", "杜塞尔多夫", "纽伦堡B队", "卡尔斯鲁厄B队", "雷根斯堡B队", "菲尔特B队", "马格德堡B队", "布伦瑞克B队"],
            "意甲": ["尤文", "国米", "AC米兰", "那不勒斯", "罗马", "拉齐奥", "亚特兰大", "佛罗伦萨", "都灵", "桑普多利亚", "萨勒尼塔纳", "博洛尼亚", "乌迪内斯", "维罗纳", "恩波利", "蒙扎", "萨索洛", "莱切", "弗洛西诺内", "卡利亚里"],
            "意乙": ["热那亚", "威尼斯", "比萨", "布雷西亚", "帕尔马", "巴里", "卡利亚里B队", "科森扎", "希塔德拉", "斯佩齐亚", "阿斯科利", "佩鲁贾", "雷吉纳", "弗罗西诺内B队", "特尔纳纳", "克罗托内", "卡坦扎罗", "雷吉亚纳", "维琴察", "帕多瓦", "摩德纳", "亚历山德里亚"],
            "意丙": ["尤文U23", "国米U23", "AC米兰U23", "那不勒斯U23", "罗马U23", "拉齐奥U23", "亚特兰大U23", "佛罗伦萨U23", "都灵U23", "桑普多利亚U23"],
            "法甲": ["巴黎", "里昂", "马赛", "里尔", "摩纳哥", "雷恩", "尼斯", "朗斯", "布雷斯特", "图卢兹", "欧塞尔", "南特", "勒阿弗尔", "洛里昂", "巴黎FC", "梅斯", "克莱蒙", "特鲁瓦", "蒙彼利埃", "斯特拉斯堡"],
            "法乙": ["第戎", "阿雅克肖", "卡昂", "勒阿弗尔B队", "南锡", "瓦朗谢讷", "奎维利鲁昂", "巴黎FCB队", "尼奥尔", "索肖", "欧塞尔B队", "沙托鲁", "亚眠", "奥尔良", "克维伊", "布尔格", "敦刻尔克", "圣埃蒂安", "罗德兹", "甘冈", "勒芒", "昂纳西"],
            "法丙": ["巴黎U23", "里昂U23", "马赛U23", "里尔U23", "摩纳哥U23", "雷恩U23", "尼斯U23", "朗斯U23", "布雷斯特U23", "图卢兹U23"],
            "葡超": ["本菲卡", "波尔图", "里斯本竞技", "布拉加", "吉马良斯", "阿罗卡", "维泽拉", "埃斯托里尔", "法马利康", "马里迪莫", "博阿维斯塔", "圣克拉拉", "里奥阿维", "沙维什", "莫雷拉", "瓦尔津"],
            "葡甲": ["波尔图B队", "本菲卡B队", "里斯本竞技B队", "布拉加B队", "吉马良斯B队", "阿罗卡B队", "维泽拉B队", "埃斯托里尔B队", "法马利康B队", "马里迪莫B队", "博阿维斯塔B队", "圣克拉拉B队", "里奥阿维B队", "沙维什B队", "莫雷拉B队", "瓦尔津B队"],
            "葡乙": ["波尔图C队", "本菲卡C队", "里斯本竞技C队", "布拉加C队", "吉马良斯C队", "阿罗卡C队", "维泽拉C队", "埃斯托里尔C队", "法马利康C队", "马里迪莫C队"],
            "荷甲": ["阿贾克斯", "埃因霍温", "费耶诺德", "阿尔克马尔", "特温特", "维特斯", "海伦芬", "乌特勒支", "格罗宁根", "鹿特丹斯巴达", "海牙", "兹沃勒", "威廉二世", "阿尔梅勒城", "福伦丹", "埃门"],
            "荷乙": ["阿贾克斯B队", "埃因霍温B队", "费耶诺德B队", "阿尔克马尔B队", "特温特B队", "维特斯B队", "海伦芬B队", "乌特勒支B队", "格罗宁根B队", "鹿特丹斯巴达B队", "海牙B队", "兹沃勒B队", "威廉二世B队", "阿尔梅勒城B队", "福伦丹B队", "埃门B队"],
            "荷丙": ["阿贾克斯C队", "埃因霍温C队", "费耶诺德C队", "阿尔克马尔C队", "特温特C队", "维特斯C队", "海伦芬C队", "乌特勒支C队", "格罗宁根C队", "鹿特丹斯巴达C队"],
            "比甲": ["布鲁日", "安德莱赫特", "标准列日", "根特", "安特卫普", "亨克", "奥斯坦德", "洛克伦", "圣特赖登", "梅赫伦", "科特赖克", "维尔通", "沙勒罗瓦", "色当", "布鲁塞尔联", "瓦勒海姆", "奥德赫维里"],
            "比乙": ["布鲁日B队", "安德莱赫特B队", "标准列日B队", "根特B队", "安特卫普B队", "亨克B队", "奥斯坦德B队", "洛克伦B队", "圣特赖登B队", "梅赫伦B队"],
            "奥超": ["萨尔茨堡红牛", "维也纳快速", "奥地利维也纳", "格拉茨风暴", "林茨", "沃尔夫斯贝格", "阿德米拉", "里德", "马特斯堡", "圣珀尔滕"],
            "奥甲": ["萨尔茨堡红牛B队", "维也纳快速B队", "奥地利维也纳B队", "格拉茨风暴B队", "林茨B队", "沃尔夫斯贝格B队", "阿德米拉B队", "里德B队", "马特斯堡B队", "圣珀尔滕B队"],
            "瑞超": ["马尔默", "哈马比", "哥德堡", "埃尔夫斯堡", "索尔纳", "天狼星", "北雪平", "佐加顿斯", "AIK索尔纳", "赫根", "卡尔马", "厄勒布鲁", "松兹瓦尔", "奥斯特桑斯", "法尔肯堡", "布洛马波卡纳"],
            "瑞甲": ["马尔默B队", "哈马比B队", "哥德堡B队", "埃尔夫斯堡B队", "索尔纳B队", "天狼星B队", "北雪平B队", "佐加顿斯B队", "AIK索尔纳B队", "赫根B队"],
            "挪超": ["莫尔德", "罗森博格", "博德闪耀", "维京", "奥德", "海于格松", "斯特罗姆加斯特", "利勒斯特罗姆", "瓦勒伦加", "桑纳菲尤尔", "腓特烈斯塔", "奥斯陆KFUM", "布莱尼", "特罗姆瑟", "克里斯蒂安松", "孔斯温厄尔"],
            "挪甲": ["莫尔德B队", "罗森博格B队", "博德闪耀B队", "维京B队", "奥德B队", "海于格松B队", "斯特罗姆加斯特B队", "利勒斯特罗姆B队", "瓦勒伦加B队", "桑纳菲尤尔B队"],
            "土超": ["加拉塔萨雷", "费内巴切", "贝西克塔斯", "特拉布宗体育", "伊斯坦布尔", "安塔利亚体育", "开塞利体育", "锡瓦斯体育", "科尼亚体育", "加济安泰普体育", "代米尔体育", "哈塔伊体育", "布尔萨体育", "阿达纳体育", "里泽体育", "伊兹密尔体育"],
            "土甲": ["加拉塔萨雷B队", "费内巴切B队", "贝西克塔斯B队", "特拉布宗体育B队", "伊斯坦布尔B队", "安塔利亚体育B队", "开塞利体育B队", "锡瓦斯体育B队", "科尼亚体育B队", "加济安泰普体育B队"],
            
            // 亚洲
            "中超": ["海港", "泰山", "国安", "申花", "三镇", "浙江", "蓉城", "津门虎", "大连人", "深圳", "沧州", "亚泰", "梅州", "河南", "海牛", "南通"],
            "中甲": ["广州", "昆山", "陕西", "黑龙江", "四川九牛", "苏州东吴", "江西联盛", "淄博蹴鞠", "南京城市", "辽宁沈阳城市", "青岛西海岸", "广西平果哈嘹", "石家庄功夫", "济南兴洲", "丹东腾跃", "延边龙鼎"],
            "中乙": ["泰安天贶", "海南之星", "武汉江城", "苏州东吴B队", "青岛红狮", "泉州亚新", "云南玉昆", "重庆铜梁龙", "上海嘉定汇龙", "广西平果哈嘹B队"],
            "日职联": ["横滨水手", "川崎前锋", "大阪樱花", "鹿岛鹿角", "名古屋鲸八", "浦和红钻", "柏太阳神", "广岛三箭", "神户胜利船", "札幌冈萨多", "清水心跳", "仙台七夕", "福冈黄蜂", "湘南海洋", "横滨FC", "大分三神"],
            "日乙": ["东京绿茵", "京都不死鸟", "磐田喜悦", "冈山绿雉", "熊本深红", "长崎成功丸", "千叶市原", "枥木SC", "群马草津温泉", "大宫松鼠", "水户蜀葵", "德岛漩涡", "山口雷诺法", "冈山绿雉B队", "熊本深红B队", "长崎成功丸B队"],
            "日丙": ["横滨水手U23", "川崎前锋U23", "大阪樱花U23", "鹿岛鹿角U23", "名古屋鲸八U23", "浦和红钻U23", "柏太阳神U23", "广岛三箭U23", "神户胜利船U23", "札幌冈萨多U23"],
            "韩职": ["全北现代", "首尔FC", "蔚山现代", "济州联", "大邱FC", "水原三星", "浦项制铁", "光州FC", "仁川联", "江原FC", "城南FC", "安阳FC", "庆南FC", "釜山偶像"],
            "韩乙": ["全北现代B队", "首尔FCB队", "蔚山现代B队", "济州联B队", "大邱FCB队", "水原三星B队", "浦项制铁B队", "光州FCB队", "仁川联B队", "江原FCB队"],
            "韩丙": ["全北现代U23", "首尔FCU23", "蔚山现代U23", "济州联U23", "大邱FCU23", "水原三星U23", "浦项制铁U23", "光州FCU23", "仁川联U23", "江原FCU23"],
            "澳超": ["阿德莱德联", "奥克兰FC", "布里斯班狮吼", "堪培拉联", "中央海岸水手", "麦克阿瑟FC", "墨尔本城", "墨尔本胜利", "纽卡斯尔喷气机", "珀斯荣耀", "悉尼FC", "惠灵顿凤凰", "西悉尼流浪者", "西部联FC"],
            "澳甲": ["阿德莱德联B队", "奥克兰FCB队", "布里斯班狮吼B队", "堪培拉联B队", "中央海岸水手B队", "麦克阿瑟FCB队", "墨尔本城B队", "墨尔本胜利B队", "纽卡斯尔喷气机B队", "珀斯荣耀B队"],
            "泰超": ["武里南联", "曼谷联", "春武里", "清莱联", "狮子港", "巴蜀基利", "拉查武里", "北榄城", "曼谷玻璃", "素可泰", "猜纳犀鸟", "乌汶联", "呵叻联", "孔敬联", "清迈联", "罗勇海军"],
            "泰甲": ["武里南联B队", "曼谷联B队", "春武里B队", "清莱联B队", "狮子港B队", "巴蜀基利B队", "拉查武里B队", "北榄城B队", "曼谷玻璃B队", "素可泰B队"],
            "越超": ["河内FC", "胡志明市FC", "平阳FC", "庆和FC", "广宁FC", "岘港FC", "海防FC", "宁平FC", "清化FC", "乂安FC", "嘉莱黄莺", "同塔FC", "河内公安", "芽庄FC", "芹苴FC", "平定FC"],
            "越甲": ["河内FCB队", "胡志明市FCB队", "平阳FCB队", "庆和FCB队", "广宁FCB队", "岘港FCB队", "海防FCB队", "宁平FCB队", "清化FCB队", "乂安FCB队"],
            
            // 美洲
            "巴甲": ["弗拉门戈", "圣保罗", "科林蒂安", "弗鲁米嫩塞", "帕尔梅拉斯", "桑托斯", "格雷米奥", "瓦斯科达伽马", "巴拉纳竞技", "博塔弗戈", "米内罗竞技", "克鲁塞罗", "戈亚尼亚竞技", "库里蒂巴", "巴伊亚", "维多利亚"],
            "巴乙": ["累西腓体育", "圣克鲁斯", "诺蒂卡", "巴拉纳", "庞特普雷塔", "米内罗美洲", "奥瓦", "伊图阿诺", "巴西瓜拉尼", "克里西乌马", "塞阿拉", "阿拉戈亚诺体育", "维拉诺瓦", "雷加塔斯", "戈亚斯", "马瑙斯"],
            "巴丙": ["弗拉门戈B队", "圣保罗B队", "科林蒂安B队", "弗鲁米嫩塞B队", "帕尔梅拉斯B队", "桑托斯B队", "格雷米奥B队", "瓦斯科达伽马B队", "巴拉纳竞技B队", "博塔弗戈B队"],
            "阿甲": ["河床", "博卡", "独立队", "拉普拉塔大学生", "圣洛伦索", "萨斯菲尔德", "纽维尔老男孩", "竞技俱乐部", "科隆竞技", "飓风队", "班菲尔德", "阿根廷青年人", "贝尔格拉诺", "阿尔马格罗", "圣马丁", "图库曼竞技"],
            "阿乙": ["河床B队", "博卡B队", "独立队B队", "拉普拉塔大学生B队", "圣洛伦索B队", "萨斯菲尔德B队", "纽维尔老男孩B队", "竞技俱乐部B队", "科隆竞技B队", "飓风队B队"],
            "阿丙": ["河床U23", "博卡U23", "独立队U23", "拉普拉塔大学生U23", "圣洛伦索U23", "萨斯菲尔德U23", "纽维尔老男孩U23", "竞技俱乐部U23", "科隆竞技U23", "飓风队U23"],
            "美职": ["洛杉矶银河", "纽约红牛", "西雅图海湾人", "亚特兰大联", "多伦多FC", "蒙特利尔冲击", "温哥华白帽", "休斯顿迪纳摩", "达拉斯FC", "芝加哥火焰", "哥伦布机员", "费城联合", "奥兰多城", "华盛顿联", "新英格兰革命", "迈阿密国际"],
            "美乙": ["洛杉矶银河B队", "纽约红牛B队", "西雅图海湾人B队", "亚特兰大联B队", "多伦多FCB队", "蒙特利尔冲击B队", "温哥华白帽B队", "休斯顿迪纳摩B队", "达拉斯FCB队", "芝加哥火焰B队"],
            "墨超": ["美洲", "瓜达拉哈拉", "蒙特雷", "老虎大学", "蓝十字", "帕丘卡", "莱昂", "蒂华纳", "桑托斯拉古纳", "克雷塔罗", "华雷斯", "普埃布拉", "墨西哥美洲狮", "阿特拉斯", "圣路易斯", "马萨特兰"],
            "墨甲": ["美洲B队", "瓜达拉哈拉B队", "蒙特雷B队", "老虎大学B队", "蓝十字B队", "帕丘卡B队", "莱昂B队", "蒂华纳B队", "桑托斯拉古纳B队", "克雷塔罗B队"],
            "智甲": ["科洛科洛", "智利大学", "天主教大学", "奥希金斯", "科布雷萨尔", "瓦奇巴托", "埃弗顿VM", "库里科 Unido", "巴勒斯坦人", "安托法加斯塔", "伊基克体育", "科比亚波", "拉卡莱拉联合", "马加拉内斯", "塔尔卡流浪者", "奥达克斯意大利人"],
            "智乙": ["科洛科洛B队", "智利大学B队", "天主教大学B队", "奥希金斯B队", "科布雷萨尔B队", "瓦奇巴托B队", "埃弗顿VM B队", "库里科 Unido B队", "巴勒斯坦人B队", "安托法加斯塔B队"],
            
            // 非洲
            "南非超": ["奥兰多海盗", "凯撒酋长", "马梅洛迪日落", "超级体育联", "开普敦城", "德班皇家", "马里茨堡联", "阿玛祖鲁", "理查兹湾", "瑟库库内联", "茨普帕联", "莫罗卡燕子", "查尔顿维尔", "金箭", "马利特兰", "自由州星"],
            "南非甲": ["奥兰多海盗B队", "凯撒酋长B队", "马梅洛迪日落B队", "超级体育联B队", "开普敦城B队", "德班皇家B队", "马里茨堡联B队", "阿玛祖鲁B队", "理查兹湾B队", "瑟库库内联B队"],
            "尼日利亚超": ["卡诺支柱", "埃努古流浪者", "卡杜纳联", "河流联", "阿克瓦联", "阳光星", "高原联", "阿南布拉联", "尼日尔龙卷风", "包奇联", "贡贝联", "卡齐纳联", "拉各斯联", "奥贡州联", "三角洲联", "贝努埃联"],
            
            // 国际赛事
            "世界杯": ["巴西", "阿根廷", "法国", "德国", "西班牙", "葡萄牙", "英格兰", "荷兰", "比利时", "克罗地亚", "乌拉圭", "丹麦", "墨西哥", "瑞士", "美国", "塞内加尔", "波兰", "威尔士", "瑞典", "突尼斯", "日本", "韩国", "伊朗", "澳大利亚"],
            "欧洲杯": ["法国", "葡萄牙", "德国", "西班牙", "意大利", "英格兰", "荷兰", "比利时", "克罗地亚", "瑞典", "丹麦", "瑞士", "奥地利", "乌克兰", "波兰", "捷克"],
            "美洲杯": ["巴西", "阿根廷", "乌拉圭", "智利", "哥伦比亚", "秘鲁", "巴拉圭", "厄瓜多尔", "玻利维亚", "委内瑞拉"],
            "亚冠": ["海港", "泰山", "国安", "申花", "全北现代", "首尔FC", "蔚山现代", "横滨水手", "川崎前锋", "浦和红钻", "利雅得胜利", "利雅得新月", "吉达联合", "迪拜胜利", "墨尔本城", "阿德莱德联"],
            "欧冠": ["皇马", "巴萨", "拜仁", "曼城", "曼联", "利物浦", "切尔西", "尤文", "国米", "AC米兰", "巴黎", "多特", "勒沃库森", "莱比锡", "热刺", "阿贾克斯"],
            "欧联杯": ["阿森纳", "罗马", "拉齐奥", "亚特兰大", "摩纳哥", "马赛", "雷恩", "比利亚雷亚尔", "佛罗伦萨", "都灵"],
            "欧会杯": ["西汉姆", "罗马", "佛罗伦萨", "莱斯特", "费耶诺德", "阿尔克马尔", "布拉加", "吉马良斯"],
            
            // 其他联赛（平级显示）
            "其他联赛": []
        };

        // 2. Firebase配置
        const firebaseConfig = {
    apiKey: "AIzaSyD2gY00krxzujQ6ol4lbShxOflMw48vDdc",
    authDomain: "zuqiushuju.firebaseapp.com",
    databaseURL: "https://zuqiushuju-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "zuqiushuju",
    storageBucket: "zuqiushuju.firebasestorage.app",
    messagingSenderId: "1033657621876",
    appId: "1:1033657621876:web:6eed7f50786f1cd703a021",
    measurementId: "G-JWF2CEWXL1"
  };
        let firebaseApp = null;
        let dbRef = null;
        try {
            if (!firebase.apps.length) {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                dbRef = firebase.database().ref('matchDataFinal');
            }
        } catch (err) {
            console.error("Firebase初始化失败 ", err);
            alert("云端功能不可用：" + err.message);
        }

        // 3. 页面初始化
        window.onload = function() {
            loadLeagues();
            document.getElementById('leagueSelect').onchange = function() {
                loadTeams(this.value);
            };
            loadLocalData();
        };

        // 加载联赛
        function loadLeagues() {
            const leagueSelect = document.getElementById('leagueSelect');
            const sortedLeagues = Object.keys(leagueTeamsMap).sort((a, b) => a.localeCompare(b));
            sortedLeagues.forEach(league => {
                const option = document.createElement('option');
                option.value = league;
                option.textContent = league;
                leagueSelect.appendChild(option);
            });
        }

        // 加载球队
        function loadTeams(league) {
            const homeSelect = document.getElementById('homeTeamSelect');
            const awaySelect = document.getElementById('awayTeamSelect');
            const homeInput = document.getElementById('homeTeamInput');
            const awayInput = document.getElementById('awayTeamInput');

            homeSelect.innerHTML = '';
            awaySelect.innerHTML = '';
            homeSelect.classList.remove('hidden');
            awaySelect.classList.remove('hidden');
            homeInput.classList.add('hidden');
            awayInput.classList.add('hidden');

            if (league === "其他联赛") {
                homeSelect.classList.add('hidden');
                awaySelect.classList.add('hidden');
                homeInput.classList.remove('hidden');
                awayInput.classList.remove('hidden');
                return;
            }

            const teams = leagueTeamsMap[league] || [];
            const defaultOpt = document.createElement('option');
            defaultOpt.value = "";
            defaultOpt.textContent = "请选择球队";
            homeSelect.appendChild(defaultOpt.cloneNode(true));
            awaySelect.appendChild(defaultOpt.cloneNode(true));

            teams.forEach(team => {
                const opt = document.createElement('option');
                opt.value = team;
                opt.textContent = team;
                homeSelect.appendChild(opt.cloneNode(true));
                awaySelect.appendChild(opt.cloneNode(true));
            });
        }

        // 联赛搜索
        function searchLeagues() {
            const keyword = document.getElementById('leagueSearchInput').value.toLowerCase().trim();
            const options = document.getElementById('leagueSelect').options;
            for (let i = 0; i < options.length; i++) {
                options[i].style.display = options[i].textContent.toLowerCase().includes(keyword) ? "" : "none";
            }
        }

        // 去重依据
        function getUniqueKey(data) {
            return `${data.league}_${data.homeTeam}_${data.awayTeam}_${data.date}`;
        }

        // 1. 添加数据（无提示）
        function addData() {
            const formData = getFormData();
            if (!validateForm(formData)) return;

            let localData = JSON.parse(localStorage.getItem('matchData')) || [];
            const dataKey = getUniqueKey(formData);

            if (localData.some(item => getUniqueKey(item) === dataKey)) {
                return; // 重复数据不添加，无提示
            }

            localData.push({ ...formData, id: Date.now() });
            localStorage.setItem('matchData', JSON.stringify(localData));
            renderTable(localData);
            clearForm(); // 添加后清空表单（仅表单，不删数据）
        }

        // 2. 单条删除（保留提示）
        function deleteSingleData(id) {
            if (!confirm("确定删除该条本地数据？（云端数据不受影响）")) return;

            let localData = JSON.parse(localStorage.getItem('matchData')) || [];
            localData = localData.filter(item => item.id !== id);
            localStorage.setItem('matchData', JSON.stringify(localData));
            renderTable(localData);

            alert("本地数据删除成功！云端数据未变动");
        }

        // 3. 清空本地数据（修复无反应问题，保留提示）
        function clearAllData() {
            if (!confirm("确定清空所有本地数据？此操作不可恢复！")) return;

            // 清空本地存储
            localStorage.removeItem('matchData');
            // 清空表单
            clearForm();
            // 刷新表格
            renderTable([]);

            alert("所有本地数据已清空！");
        }

        // 仅清空表单（添加后调用，无提示）
        function clearForm() {
            document.getElementById('leagueSelect').value = "";
            document.getElementById('leagueSearchInput').value = "";
            document.getElementById('homeTeamSelect').innerHTML = '<option value="">请先选择联赛</option>';
            document.getElementById('awayTeamSelect').innerHTML = '<option value="">请先选择联赛</option>';
            document.getElementById('homeTeamInput').value = "";
            document.getElementById('awayTeamInput').value = "";
            document.getElementById('handicapSelect').value = "";
            document.getElementById('scoreSelect').value = "";
            document.getElementById('oddsChangeInput').value = "";

            // 恢复显示状态
            document.getElementById('homeTeamSelect').classList.remove('hidden');
            document.getElementById('awayTeamSelect').classList.remove('hidden');
            document.getElementById('homeTeamInput').classList.add('hidden');
            document.getElementById('awayTeamInput').classList.add('hidden');

            // 恢复所有联赛选项
            const options = document.getElementById('leagueSelect').options;
            for (let i = 0; i < options.length; i++) {
                options[i].style.display = "";
            }
        }

        // 4. 导出本地（保留提示）
        function exportLocalData() {
            const localData = JSON.parse(localStorage.getItem('matchData')) || [];
            if (localData.length === 0) {
                alert("本地无数据可导出！");
                return;
            }

            const headers = "日期,联赛,主队,客队,让球,比分,赔率变化\n";
            const rows = localData.map(item => 
                `${item.date},${item.league},${item.homeTeam},${item.awayTeam},${item.handicap},${item.score},${item.oddsChange}`
            ).join("\n");
            const csvContent = "\uFEFF" + headers + rows;

            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `竞彩赛事数据_${new Date().toLocaleDateString()}.csv`;
            a.click();
            URL.revokeObjectURL(a.href);

            alert("本地数据导出成功！");
        }

        // 5. 上传云端（保留提示）
        function uploadToCloud() {
            if (!dbRef) { alert("云端功能未初始化！"); return; }
            if (!navigator.onLine) { alert("当前离线，无法上传！"); return; }

            const localData = JSON.parse(localStorage.getItem('matchData')) || [];
            if (localData.length === 0) { alert("本地无数据可上传！"); return; }

            dbRef.once('value', snapshot => {
                const cloudData = snapshot.val() || {};
                const cloudKeys = new Set();

                Object.values(cloudData).forEach(item => {
                    if (item.league && item.homeTeam && item.awayTeam && item.date) {
                        cloudKeys.add(getUniqueKey(item));
                    }
                });

                const dataToUpload = localData.filter(item => !cloudKeys.has(getUniqueKey(item)));
                if (dataToUpload.length === 0) {
                    alert("本地数据与云端已同步，无新增数据！");
                    return;
                }

                const uploadObj = {};
                dataToUpload.forEach(item => {
                    const key = dbRef.push().key;
                    uploadObj[key] = item;
                });

                dbRef.update(uploadObj)
                    .then(() => alert(`上传成功！向云端添加${dataToUpload.length}条新数据`))
                    .catch(err => alert("上传失败：" + err.message));
            });
        }

        // 6. 下载云端（保留提示）
        function downloadFromCloud() {
            if (!dbRef) { alert("云端功能未初始化！"); return; }
            if (!navigator.onLine) { alert("当前离线，无法下载！"); return; }

            if (!confirm("确定下载云端数据？本地数据将与云端去重合并（不覆盖）")) return;

            dbRef.once('value', snapshot => {
                const cloudData = snapshot.val() || {};
                const cloudList = Object.values(cloudData).filter(item => 
                    item.league && item.homeTeam && item.awayTeam && item.date && item.id
                );

                if (cloudList.length === 0) { alert("云端无有效数据！"); return; }

                let localData = JSON.parse(localStorage.getItem('matchData')) || [];
                const localKeys = new Set(localData.map(item => getUniqueKey(item)));
                const dataToAdd = cloudList.filter(item => !localKeys.has(getUniqueKey(item)));

                if (dataToAdd.length === 0) {
                    alert("本地已包含云端所有数据，无需下载！"); return;
                }

                const mergedData = [...localData, ...dataToAdd];
                localStorage.setItem('matchData', JSON.stringify(mergedData));
                renderTable(mergedData);

                alert(`下载成功！新增${dataToAdd.length}条数据，合并后共${mergedData.length}条`);
            }).catch(err => alert("下载失败：" + err.message));
        }

        // 辅助函数
        function getFormData() {
            const league = document.getElementById('leagueSelect').value;
            let homeTeam, awayTeam;

            if (league === "其他联赛") {
                homeTeam = document.getElementById('homeTeamInput').value.trim();
                awayTeam = document.getElementById('awayTeamInput').value.trim();
            } else {
                homeTeam = document.getElementById('homeTeamSelect').value;
                awayTeam = document.getElementById('awayTeamSelect').value;
            }

            return {
                date: new Date().toISOString().split('T')[0],
                league: league,
                homeTeam: homeTeam,
                awayTeam: awayTeam,
                handicap: document.getElementById('handicapSelect').value,
                score: document.getElementById('scoreSelect').value,
                oddsChange: document.getElementById('oddsChangeInput').value.trim()
            };
        }

        function validateForm(data) {
            if (!data.league) { alert("请选择联赛！"); return false; }
            if (!data.homeTeam) { alert("请选择/输入主队！"); return false; }
            if (!data.awayTeam) { alert("请选择/输入客队！"); return false; }
            if (!data.handicap) { alert("请选择让球！"); return false; }
            if (!data.score) { alert("请选择比分！"); return false; }
            if (!data.oddsChange) { alert("请输入赔率变化！"); return false; }
            return true;
        }

        function loadLocalData() {
            const localData = JSON.parse(localStorage.getItem('matchData')) || [];
            renderTable(localData);
        }

        function renderTable(data) {
            const tableBody = document.getElementById('tableBody');
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" align="center">暂无赛事数据</td></tr>';
                return;
            }

            let html = '';
            data.forEach(item => {
                html += `<tr>
                    <td>${item.date}</td>
                    <td>${item.league}</td>
                    <td>${item.homeTeam}</td>
                    <td>${item.awayTeam}</td>
                    <td>${item.handicap}</td>
                    <td>${item.score}</td>
                    <td>${item.oddsChange}</td>
                    <td><button class="btn-single-delete" onclick="deleteSingleData(${item.id})">删除</button></td>
                </tr>`;
            });
            tableBody.innerHTML = html;
        }

        // 暴露全局函数
        window.addData = addData;
        window.deleteSingleData = deleteSingleData;
        window.clearAllData = clearAllData;
        window.clearForm = clearForm;
        window.exportLocalData = exportLocalData;
        window.uploadToCloud = uploadToCloud;
        window.downloadFromCloud = downloadFromCloud;
        window.searchLeagues = searchLeagues;
    </script>
</body>
</html>